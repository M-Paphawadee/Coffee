<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>COFFEELINE - Coffee Production Management</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  :root{
    --brown:#8B4513;--brown2:#D2691E;--muted:#6c757d;--ok:#28a745;--warn:#ffc107;--danger:#dc3545;--info:#0d6efd;
    --bg1:#f5f7fa;--bg2:#c3cfe2;
  }
  html,body{height:100%;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,var(--bg1) 0%,var(--bg2) 100%);min-height:100vh}
  a{color:inherit;text-decoration:none}
  
  /* ====== HEADER ====== */
  .header{display:none;background:linear-gradient(135deg,var(--brown) 0%,var(--brown2) 100%);color:#fff;padding:14px 80px;align-items:center;justify-content:space-between;box-shadow:0 6px 18px rgba(0,0,0,0.1);z-index:40}
  .brand{font-weight:700;font-size:1.3rem}
  .brand a{color:#fff}
  .userbox{display:flex;gap:10px;align-items:center}
  .chip{background:rgba(255,255,255,.2);padding:6px 12px;border-radius:999px;font-size:0.9rem}
  .btn{border:none;border-radius:10px;padding:8px 14px;cursor:pointer;font-size:0.9rem;transition:all 0.2s}
  .btn:hover{opacity:.9;transform:translateY(-1px)}
  .btn-ghost{background:rgba(255,255,255,.25);color:#fff}
  .btn-ghost:hover{background:rgba(255,255,255,.35)}
  
  /* ====== CONTAINER ====== */
  .wrap{max-width:1200px;margin:0 auto;padding:20px}
  .page{display:none;min-height:calc(100vh - 72px)}
  
  /* ====== LOGIN ====== */
  .center{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
  .login{width:100%;max-width:430px;background:#fff;border-radius:16px;padding:30px;box-shadow:0 10px 40px rgba(0,0,0,0.15)}
  .login h1{color:var(--brown);margin-bottom:4px;font-size:1.8rem}
  .login small{color:var(--muted);display:block;margin-bottom:16px}
  .row{display:flex;flex-direction:column;gap:4px;margin-top:14px}
  .row label{font-size:0.85rem;color:var(--muted);font-weight:600}
  .row input{padding:11px 14px;border:1px solid #dcdcdc;border-radius:10px;font-size:0.95rem;transition:all 0.2s}
  .row input:focus{outline:none;border-color:var(--info);box-shadow:0 0 0 3px rgba(13,110,253,0.1)}
  .row .hint{font-size:0.78rem;color:var(--muted);margin-top:2px}
  .btn-full{width:100%;padding:12px 14px;border:none;border-radius:12px;background:var(--brown);color:#fff;font-weight:600;margin-top:14px;font-size:0.95rem;cursor:pointer;transition:all 0.2s}
  .btn-full:hover{background:#6d3410;transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,0.2)}
  .btn-full.secondary{background:var(--info)}
  .btn-full.secondary:hover{background:#0a52cc}
  
  /* ====== STATS ====== */
  .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px;margin-bottom:20px}
  .stat{background:#fff;border-radius:14px;padding:16px;box-shadow:0 6px 18px rgba(0,0,0,0.08);text-align:center;transition:all 0.2s}
  .stat:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,0.12)}
  .stat h3{color:var(--brown);font-size:1.6rem;margin-bottom:4px}
  .stat p{color:var(--muted);font-size:0.9rem}
  .stat small{color:#28a745;font-size:0.8rem}
  
  /* ====== CARDS GRID ====== */
  .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(350px,1fr));gap:18px;margin-top:16px}
  .card{background:#fff;border-radius:14px;padding:18px;box-shadow:0 6px 18px rgba(0,0,0,0.08);border-left:5px solid var(--brown);transition:all 0.2s}
  .card:hover{transform:translateY(-2px);box-shadow:0 10px 28px rgba(0,0,0,0.12)}
  .card .hd{display:flex;gap:10px;align-items:center;border-bottom:1px solid #eee;padding-bottom:12px;margin-bottom:12px;font-size:1rem;font-weight:600}
  .card .hd span{font-size:1.4rem}
  
  .li{display:flex;gap:10px;align-items:center;background:#f8f9fa;border-radius:8px;padding:11px 12px;margin-top:8px;cursor:pointer;transition:all 0.2s;font-size:0.9rem}
  .li:hover{background:#eef1f4;transform:translateX(3px);box-shadow:0 2px 8px rgba(0,0,0,0.08)}
  .dot{color:var(--brown);font-weight:bold}
  .badge{margin-left:auto;background:var(--danger);color:#fff;border-radius:999px;padding:3px 8px;font-size:0.7rem;font-weight:700;min-width:20px;text-align:center}
  
  /* ====== PAGE (Generic Template) ====== */
  .crumbs{font-size:0.85rem;color:var(--muted);margin-bottom:12px;line-height:1.6}
  .crumbs a{color:var(--info);cursor:pointer}
  .crumbs a:hover{text-decoration:underline}
  .title{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:12px}
  .title h2{font-size:1.3rem;color:#111}
  .title .actions{display:flex;gap:10px}
  
  .grid2{display:grid;grid-template-columns:1fr 1.5fr;gap:14px}
  @media(max-width:1024px){.grid2{grid-template-columns:1fr}}
  
  .form{background:#fff;border-radius:14px;padding:18px;box-shadow:0 6px 18px rgba(0,0,0,0.08)}
  .form h3{font-size:1.1rem;margin-bottom:14px;color:#111}
  .form .g{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  @media(max-width:768px){.form .g{grid-template-columns:1fr}}
  .form label{font-size:0.85rem;color:var(--muted);font-weight:600;display:block;margin-bottom:4px}
  .form input,.form select,.form textarea{width:100%;padding:10px 12px;border:1px solid #dcdcdc;border-radius:10px;font-size:0.9rem;font-family:inherit;transition:all 0.2s}
  .form input:focus,.form select:focus,.form textarea:focus{outline:none;border-color:var(--info);box-shadow:0 0 0 3px rgba(13,110,253,0.1)}
  .form textarea{grid-column:1/-1;min-height:100px;resize:vertical}
  
  .table-container{background:#fff;border-radius:14px;box-shadow:0 6px 18px rgba(0,0,0,0.08);overflow:hidden}
  .table{width:100%;border-collapse:collapse;font-size:0.9rem}
  .table th{background:#f8f9fa;padding:12px;border-bottom:2px solid #dcdcdc;text-align:left;font-weight:600;color:#333}
  .table td{padding:12px;border-bottom:1px solid #eee}
  .table tr:hover{background:#f9fafb}
  .table tr:last-child td{border-bottom:none}
  .pill{padding:5px 10px;border-radius:999px;font-size:0.75rem;font-weight:600;border:1px solid}
  .pill.ok{background:#e9f9ee;color:#177a33;border-color:#bff0c9}
  .pill.warn{background:#fff6dd;color:#9b7b0a;border-color:#ffe193}
  .pill.danger{background:#ffe9e9;color:#8b0000;border-color:#f5c2c2}
  
  /* ====== DRAWER ====== */
  .overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0);z-index:40;transition:background 0.35s;pointer-events:none}
  .overlay.open{background:rgba(0,0,0,0.3);pointer-events:auto}
  
  .drawer{position:fixed;top:0;right:-420px;width:420px;max-width:100vw;height:100vh;background:#fff;box-shadow:-6px 0 24px rgba(0,0,0,0.15);transition:right 0.35s ease-out;z-index:50;display:flex;flex-direction:column;border-left:4px solid var(--info)}
  .drawer.open{right:0}
  .drawer .hd{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;background:linear-gradient(135deg,var(--info),#57a0ff);color:#fff;font-weight:600}
  .drawer .body{padding:14px;overflow-y:auto;flex:1;background:#f6f8fb}
  .drawer .msg{background:#fff;border:1px solid #e0e0e0;border-radius:8px;padding:10px 12px;margin-bottom:10px;font-size:0.85rem;line-height:1.4}
  .drawer .msg.mine{background:#e7f1ff;margin-left:20px;text-align:right}
  .drawer .foot{padding:12px 14px;border-top:1px solid #e0e0e0;display:flex;gap:8px}
  .drawer input{flex:1;padding:10px 12px;border:1px solid #dcdcdc;border-radius:10px;font-size:0.9rem;font-family:inherit}
  .drawer input:focus{outline:none;border-color:var(--info);box-shadow:0 0 0 3px rgba(13,110,253,0.1)}
  
  .primary{background:var(--info);color:#fff}
  .primary:hover{background:#0a52cc}
  .danger{background:var(--danger);color:#fff}
  .danger:hover{background:#bb2d3b}
  
  /* ====== MODAL (‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à/‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î) ====== */
  .m-ov{position:fixed;inset:0;background:#0006;display:none;place-items:center;padding:16px;z-index:60}
  .m-ov.show{display:grid}
  .m{background:#F9F6FF;border-radius:16px;box-shadow:0 16px 40px rgba(0,0,0,.2);max-width:520px;width:100%;padding:20px;border:1px solid #E6E1F5}
  .m-title{font-size:18px;font-weight:700;margin-bottom:10px;color:#4b3a75}
  .m-line{display:flex;gap:10px;align-items:flex-start;margin:10px 0;color:#3b3b3b}
  .tick{width:18px;height:18px;border-radius:4px;border:2px solid #38b000;display:grid;place-items:center;flex:0 0 18px}
  .tick::after{content:"‚úì";font-weight:900;color:#38b000;font-size:14px;line-height:1}
  .m-note{color:#6c6a74;margin:8px 0 14px;font-size:14px}
  .m-act{display:flex;justify-content:flex-end;gap:8px}
  .btnP{background:#6F56A6;color:#fff;border-radius:14px;padding:10px 20px;border:2px solid #8B78C2;font-weight:700;cursor:pointer}
  .btnG{background:#fff;border:1px solid #ddd;border-radius:14px;padding:10px 16px}
  
  /* ====== COLOR STRIPES ====== */
  .harvest{border-left-color:#28a745}.production{border-left-color:#fd7e14}.quality{border-left-color:#dc3545}.warehouse{border-left-color:#6f42c1}.order{border-left-color:#007bff}.logistics{border-left-color:#20c997}.reports{border-left-color:#ffc107}
  
  /* ====== RESPONSIVE ====== */
  @media(max-width:768px){
    .header{padding:14px 16px}
    .wrap{padding:14px}
    .stats{grid-template-columns:1fr 1fr}
    .cards{grid-template-columns:1fr}
    .grid2{grid-template-columns:1fr}
  }
</style>
</head>
<body>

<!-- ======= LOGIN ======= -->
<div id="view-login" class="center">
  <form class="login" onsubmit="return doLogin(event)">
    <h1>‚òï COFFEELINE</h1>
    <small>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏Å‡∏≤‡πÅ‡∏ü</small>
    <div class="row">
      <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
      <input id="u" placeholder="admin ‡∏´‡∏£‡∏∑‡∏≠ staff" required>
    </div>
    <div class="row">
      <label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
      <input id="p" type="password" placeholder="‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 4 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£" minlength="4" required>
      <div class="hint">‡πÄ‡∏î‡πÇ‡∏°‡πà: ‡πÉ‡∏ä‡πâ user ‡πÉ‡∏î‡∏Å‡πá‡πÑ‡∏î‡πâ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏à‡∏≥‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå</div>
    </div>
    <button class="btn-full" type="submit">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    <button class="btn-full secondary" type="button" onclick="fillDemo()">‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡πÇ‡∏°‡πà</button>
  </form>
</div>

<!-- ======= APP HEADER ======= -->
<header id="app-header" class="header">
  <div class="brand"><a href="#/dashboard">‚òï COFFEELINE</a></div>
  <div class="userbox">
    <span class="chip">üë§ <span id="who">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</span></span>
    <button class="btn btn-ghost" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
  </div>
</header>

<!-- ======= DASHBOARD ======= -->
<main id="view-dashboard" class="page">
  <div class="wrap">
    <div class="stats">
      <div class="stat">
        <h3 id="kgToday">1,247</h3>
        <p>‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>
      </div>
      <div class="stat">
        <h3>94.5%</h3>
        <p>‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå</p>
      </div>
      <div class="stat">
        <h3 id="ordersWait">23</h3>
        <p>‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏£‡∏≠‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</p>
      </div>
      <div class="stat">
        <h3>‡∏ø847K</h3>
        <p>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</p>
      </div>
    </div>

    <div class="cards">
      <!-- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß -->
      <section class="card harvest">
        <div class="hd"><span>üå±</span><strong>‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß</strong></div>
        <div class="li" onclick="go('harvest-record')"><span class="dot">‚ñ∂</span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß</div>
        <div class="li" onclick="go('raw-material-track')"><span class="dot">‚ñ∂</span>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤</div>
        <div class="li" onclick="go('bean-quality-check')"><span class="dot">‚ñ∂</span>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÄ‡∏°‡∏•‡πá‡∏î</div>
      </section>

      <!-- ‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï -->
      <section class="card production">
        <div class="hd"><span>‚öôÔ∏è</span><strong>‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</strong></div>
        <div class="li" onclick="go('cleaning-record')"><span class="dot">‚ñ∂</span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î</div>
        <div class="li" onclick="go('sorting-record')"><span class="dot">‚ñ∂</span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡πÅ‡∏¢‡∏Å</div>
        <div class="li" onclick="go('resting-record')"><span class="dot">‚ñ∂</span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏Å‡πÄ‡∏°‡∏•‡πá‡∏î</div>
        <div class="li" onclick="go('hulling-roasting')"><span class="dot">‚ñ∂</span>‡∏Å‡∏≤‡∏£‡∏õ‡∏≠‡∏Å‡∏Ñ‡∏±‡πà‡∏ß</div>
      </section>

      <!-- ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û -->
      <section class="card quality">
        <div class="hd"><span>üîç</span><strong>‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û</strong></div>
        <div class="li" onclick="go('quality-inspection')"><span class="dot">‚ñ∂</span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û</div>
        <div class="li" onclick="go('material-tracking')"><span class="dot">‚ñ∂</span>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ú‡∏•‡∏¥‡∏ï</div>
        <div class="li" onclick="go('bean-quality')"><span class="dot">‚ñ∂</span>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÄ‡∏°‡∏•‡πá‡∏î</div>
      </section>

      <!-- ‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
      <section class="card warehouse">
        <div class="hd"><span>üì¶</span><strong>‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</strong></div>
        <div class="li" onclick="go('warehouse-harvest')"><span class="dot">‚ñ∂</span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß (‡∏Ñ‡∏•‡∏±‡∏á)</div>
        <div class="li" onclick="go('warehouse-tracking')"><span class="dot">‚ñ∂</span>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏Ñ‡∏•‡∏±‡∏á)</div>
        <div class="li" onclick="go('warehouse-quality')"><span class="dot">‚ñ∂</span>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û (‡∏Ñ‡∏•‡∏±‡∏á)</div>
      </section>

      <!-- ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠/‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ -->
      <section class="card order">
        <div class="hd"><span>üìã</span><strong>‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</strong></div>
        <div class="li" onclick="go('order-record')"><span class="dot">‚ñ∂</span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</div>
        <div class="li" onclick="go('order-status')"><span class="dot">‚ñ∂</span>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ <span id="bdg-ord" class="badge">23</span></div>
        <div class="li" onclick="go('documents')"><span class="dot">‚ñ∂</span>‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</div>
        <div class="li" onclick="toggleChat(true)"><span class="dot">‚ñ∂</span>‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ä‡∏ó‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ <span id="bdg-chat" class="badge">5</span></div>
      </section>

      <!-- ‡πÇ‡∏•‡∏à‡∏¥‡∏™‡∏ï‡∏¥‡∏Å‡∏™‡πå -->
      <section class="card logistics">
        <div class="hd"><span>üöõ</span><strong>‡∏Å‡∏≤‡∏£‡∏Ç‡∏ô‡∏™‡πà‡∏á</strong></div>
        <div class="li" onclick="go('transport-pickup')"><span class="dot">‚ñ∂</span>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
        <div class="li" onclick="go('route-schedule')"><span class="dot">‚ñ∂</span>‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</div>
        <div class="li" onclick="go('delivery-confirm')"><span class="dot">‚ñ∂</span>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</div>
      </section>

      <!-- ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô -->
      <section class="card reports">
        <div class="hd"><span>üìà</span><strong>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</strong></div>
        <div class="li" onclick="go('harvest-report')"><span class="dot">‚ñ∂</span>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß</div>
        <div class="li" onclick="go('material-report')"><span class="dot">‚ñ∂</span>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</div>
        <div class="li" onclick="go('quality-report')"><span class="dot">‚ñ∂</span>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û</div>
        <div class="li" onclick="go('trend-analysis')"><span class="dot">‚ñ∂</span>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°</div>
      </section>
    </div>
  </div>
</main>

<!-- ======= GENERIC PAGE ======= -->
<main id="view-page" class="page">
  <div class="wrap">
    <div class="crumbs"><a onclick="location.hash='#/dashboard'">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a> ‚Ä∫ <span id="crumb">‡πÄ‡∏°‡∏ô‡∏π</span></div>
    <div class="title">
      <h2 id="page-title">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π</h2>
      <div class="actions">
        <button class="btn" onclick="history.back()">‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        <button class="btn primary" onclick="savePage()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </div>
    </div>

    <div class="grid2">
      <section class="form">
        <h3>‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
        <div id="form-area" class="g"></div>
      </section>

      <section>
        <div class="table-container">
          <table class="table" id="tbl">
            <thead><tr id="th"></tr></thead>
            <tbody id="tb"></tbody>
          </table>
        </div>
      </section>
    </div>
  </div>
</main>

<!-- ======= OVERLAY + CHAT DRAWER ======= -->
<div id="overlay" class="overlay" onclick="toggleChat(false)"></div>

<aside id="chat" class="drawer" aria-hidden="true">
  <div class="hd">
    <strong>üí¨ ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ä‡∏ó‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</strong>
    <button class="btn danger" style="padding:6px 12px" onclick="toggleChat(false)">‡∏õ‡∏¥‡∏î</button>
  </div>
  <div id="chatBody" class="body"></div>
  <div class="foot">
    <input id="chatInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...">
    <button class="btn primary" style="padding:10px 16px;white-space:nowrap" onclick="sendChat()">‡∏™‡πà‡∏á</button>
  </div>
</aside>

<!-- ======= MODALS ======= -->
<div id="okOv" class="m-ov" aria-hidden="true">
  <div class="m" role="dialog" aria-modal="true" aria-labelledby="okTtl">
    <div id="okTtl" class="m-title">‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤</div>
    <div class="m-line"><span class="tick"></span> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>
    <div class="m-note">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß</div>
    <div class="m-act"><button class="btnP" id="okBtn">‡∏ï‡∏Å‡∏•‡∏á</button></div>
  </div>
</div>

<div id="errOv" class="m-ov" aria-hidden="true">
  <div class="m" role="dialog" aria-modal="true" aria-labelledby="erTtl">
    <div id="erTtl" class="m-title">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</div>
    <div class="m-line">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
    <pre id="errBox" style="display:none;background:#fff;border:1px solid #eee;border-radius:10px;padding:10px;margin-top:10px;max-height:160px;overflow:auto"></pre>
    <div class="m-act">
      <button class="btnG" id="seeErr">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>
      <button class="btnP" id="errOk">‡∏õ‡∏¥‡∏î</button>
    </div>
  </div>
</div>

<script>
/* ====== CONFIG API ====== */
const API_BASE = ""; 
// ‡∏ñ‡πâ‡∏≤‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü index.html ‡∏à‡∏≤‡∏Å‡πÅ‡∏ö‡πá‡∏Å‡πÄ‡∏≠‡∏ô‡∏î‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö API ‡πÉ‡∏´‡πâ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ß‡πà‡∏≤‡∏á (‡πÄ‡∏£‡∏µ‡∏¢‡∏Å /api/records ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢)
// ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏ô‡∏•‡∏∞‡∏û‡∏≠‡∏£‡πå‡∏ï ‡πÄ‡∏ä‡πà‡∏ô http://localhost:3000 ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô "http://localhost:3000"

/* ====== DATA: routes + field presets ====== */
const routes = {
  'harvest-record': {title:'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß', fields:[
    {k:'LotNumber', label:'‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏•‡πá‡∏≠‡∏ï', type:'text'}, 
    {k:'Date',label:'‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß',type:'date'}, 
    {k:'BeanType',label:'‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏°‡∏•‡πá‡∏î‡∏Å‡∏≤‡πÅ‡∏ü',type:'select',opts:['Arabica','Robusta','Blend']}, 
    {k:'WeightKg',label:'‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (‡∏Å‡∏Å.)',type:'number'}
  ], cols:['‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏•‡πá‡∏≠‡∏ï','‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà','‡∏ä‡∏ô‡∏¥‡∏î','‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å(‡∏Å‡∏Å.)']},
  
  'raw-material-track': {title:'‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤', fields:[
    {k:'InboundDate',label:'‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤',type:'date'}, 
    {k:'Supplier',label:'‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö',type:'text'}, 
    {k:'QuantityKg',label:'‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì(‡∏Å‡∏Å.)',type:'number'}
  ], cols:['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤','‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö','‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì(‡∏Å‡∏Å.)']},
  
  'bean-quality-check': {title:'‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÄ‡∏°‡∏•‡πá‡∏î', fields:[
    {k:'Moisture',label:'‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô(%)',type:'number'}, 
    {k:'Defects',label:'‡∏™‡∏¥‡πà‡∏á‡πÄ‡∏à‡∏∑‡∏≠‡∏õ‡∏ô(%)',type:'number'}, 
    {k:'Grade',label:'‡πÄ‡∏Å‡∏£‡∏î',type:'select',opts:['A','B','C']}
  ], cols:['‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô(%)','‡∏™‡∏¥‡πà‡∏á‡πÄ‡∏à‡∏∑‡∏≠‡∏õ‡∏ô(%)','‡πÄ‡∏Å‡∏£‡∏î']},

  'cleaning-record': {title:'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î', fields:[
    {k:'Start',label:'‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°',type:'time'}, 
    {k:'End',label:'‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î',type:'time'}, 
    {k:'Method',label:'‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î',type:'text'}
  ], cols:['‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°','‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î','‡∏ß‡∏¥‡∏ò‡∏µ']},
  
  'sorting-record': {title:'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡πÅ‡∏¢‡∏Å‡πÄ‡∏°‡∏•‡πá‡∏î', fields:[
    {k:'Batch',label:'‡πÄ‡∏•‡∏Ç‡∏ä‡∏∏‡∏î',type:'text'}, 
    {k:'Method',label:'‡∏ß‡∏¥‡∏ò‡∏µ‡∏Ñ‡∏±‡∏î‡πÅ‡∏¢‡∏Å',type:'text'}, 
    {k:'OutputKg',label:'‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï(‡∏Å‡∏Å.)',type:'number'}
  ], cols:['‡πÄ‡∏•‡∏Ç‡∏ä‡∏∏‡∏î','‡∏ß‡∏¥‡∏ò‡∏µ‡∏Ñ‡∏±‡∏î‡πÅ‡∏¢‡∏Å','‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï(‡∏Å‡∏Å.)']},
  
  'resting-record': {title:'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏Å‡πÄ‡∏°‡∏•‡πá‡∏î', fields:[
    {k:'RestStart',label:'‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏±‡∏Å',type:'datetime-local'}, 
    {k:'RestEnd',label:'‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏û‡∏±‡∏Å',type:'datetime-local'}, 
    {k:'Temp',label:'‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥(¬∞C)',type:'number'}
  ], cols:['‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏±‡∏Å','‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏û‡∏±‡∏Å','‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥']},
  
  'hulling-roasting': {title:'‡∏Å‡∏≤‡∏£‡∏õ‡∏≠‡∏Å‡∏Ñ‡∏±‡πà‡∏ß', fields:[
    {k:'RoastLevel',label:'‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡πà‡∏ß',type:'select',opts:['Light','Medium','Dark']}, 
    {k:'TimeMin',label:'‡πÄ‡∏ß‡∏•‡∏≤‡∏Ñ‡∏±‡πà‡∏ß(‡∏ô‡∏≤‡∏ó‡∏µ)',type:'number'},
    {k:'Loss%',label:'Loss (%)',type:'number'}
  ], cols:['‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏±‡πà‡∏ß','‡πÄ‡∏ß‡∏•‡∏≤‡∏Ñ‡∏±‡πà‡∏ß(‡∏ô‡∏≤‡∏ó‡∏µ)','Loss (%)']},

  'quality-inspection': {title:'‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û', fields:[
    {k:'Param',label:'‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå',type:'text'}, 
    {k:'Value',label:'‡∏Ñ‡πà‡∏≤',type:'text'}, 
    {k:'Result',label:'‡∏ú‡∏•',type:'select',opts:['‡∏ú‡πà‡∏≤‡∏ô','‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô','‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà']}
  ], cols:['‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå','‡∏Ñ‡πà‡∏≤','‡∏ú‡∏•']},
  
  'material-tracking': {title:'‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ú‡∏•‡∏¥‡∏ï', fields:[
    {k:'Date',label:'‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà',type:'date'}, 
    {k:'Item',label:'‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£',type:'text'}, 
    {k:'Qty',label:'‡∏à‡∏≥‡∏ô‡∏ß‡∏ô',type:'number'}
  ], cols:['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà','‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£','‡∏à‡∏≥‡∏ô‡∏ß‡∏ô']},
  
  'bean-quality': {title:'‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÄ‡∏°‡∏•‡πá‡∏î', fields:[
    {k:'Sample',label:'‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á',type:'text'}, 
    {k:'Score',label:'‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô',type:'number'}, 
    {k:'Note',label:'‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏',type:'textarea'}
  ], cols:['‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á','‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô','‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏']},

  'warehouse-harvest': {title:'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß (‡∏Ñ‡∏•‡∏±‡∏á)', fields:[
    {k:'Ref',label:'‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß',type:'text'}, 
    {k:'Loc',label:'‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö',type:'text'}, 
    {k:'QtyKg',label:'‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì(‡∏Å‡∏Å.)',type:'number'}
  ], cols:['‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á','‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö','‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì(‡∏Å‡∏Å.)']},
  
  'warehouse-tracking': {title:'‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏Ñ‡∏•‡∏±‡∏á)', fields:[
    {k:'Date',label:'‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà',type:'date'}, 
    {k:'Rack',label:'‡∏ä‡∏±‡πâ‡∏ô‡∏ß‡∏≤‡∏á',type:'text'}, 
    {k:'Qty',label:'‡∏à‡∏≥‡∏ô‡∏ß‡∏ô',type:'number'}
  ], cols:['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà','‡∏ä‡∏±‡πâ‡∏ô‡∏ß‡∏≤‡∏á','‡∏à‡∏≥‡∏ô‡∏ß‡∏ô']},
  
  'warehouse-quality': {title:'‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û (‡∏Ñ‡∏•‡∏±‡∏á)', fields:[
    {k:'Lot',label:'‡∏•‡πá‡∏≠‡∏ï',type:'text'}, 
    {k:'QC',label:'‡∏ú‡∏• QC',type:'select',opts:['‡∏ú‡πà‡∏≤‡∏ô','‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô','‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö']}, 
    {k:'Expire',label:'‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏',type:'date'}
  ], cols:['‡∏•‡πá‡∏≠‡∏ï','‡∏ú‡∏• QC','‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏']},

  'order-record': {title:'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠', fields:[
    {k:'OrderNo',label:'‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠',type:'text'}, 
    {k:'Customer',label:'‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤',type:'text'}, 
    {k:'Amount',label:'‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°',type:'number'}
  ], cols:['‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠','‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤','‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°']},
  
  'order-status': {title:'‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠', fields:[
    {k:'OrderNo',label:'‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠',type:'text'}, 
    {k:'Status',label:'‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞',type:'select',opts:['‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß','‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°','‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á','‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß']}, 
    {k:'ETA',label:'‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á',type:'date'}
  ], cols:['‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà','‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞','‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á']},
  
  'documents': {title:'‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£', fields:[
    {k:'DocType',label:'‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£',type:'select',opts:['‡πÉ‡∏ö‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏µ','‡πÉ‡∏ö‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á','‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á']}, 
    {k:'IssueDate',label:'‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å',type:'date'}, 
    {k:'Ref',label:'‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á',type:'text'}
  ], cols:['‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó','‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å','‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á']},

  'transport-pickup': {title:'‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', fields:[
    {k:'PickupID',label:'‡πÄ‡∏•‡∏Ç‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á',type:'text'}, 
    {k:'Driver',label:'‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö',type:'text'}, 
    {k:'Vehicle',label:'‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ',type:'text'}
  ], cols:['‡πÄ‡∏•‡∏Ç‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á','‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö','‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô']},
  
  'route-schedule': {title:'‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á', fields:[
    {k:'Route',label:'‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á',type:'text'}, 
    {k:'ShipDate',label:'‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á',type:'date'}, 
    {k:'Stop',label:'‡∏à‡∏∏‡∏î‡πÅ‡∏ß‡∏∞',type:'text'}
  ], cols:['‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á','‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á','‡∏à‡∏∏‡∏î‡πÅ‡∏ß‡∏∞']},
  
  'delivery-confirm': {title:'‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á', fields:[
    {k:'Ref',label:'‡πÄ‡∏•‡∏Ç‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£',type:'text'}, 
    {k:'Time',label:'‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á',type:'datetime-local'}, 
    {k:'Receiver',label:'‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö',type:'text'}
  ], cols:['‡πÄ‡∏•‡∏Ç‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£','‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á','‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö']},

  'harvest-report': {title:'‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß', fields:[
    {k:'From',label:'‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà',type:'date'}, 
    {k:'To',label:'‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà',type:'date'}, 
    {k:'Type',label:'‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏°‡∏•‡πá‡∏î',type:'select',opts:['‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î','Arabica','Robusta']}
  ], cols:['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà','‡∏ä‡∏ô‡∏¥‡∏î','‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì(‡∏Å‡∏Å.)']},
  
  'material-report': {title:'‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö', fields:[
    {k:'From',label:'‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà',type:'date'}, 
    {k:'To',label:'‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà',type:'date'}, 
    {k:'Warehouse',label:'‡∏Ñ‡∏•‡∏±‡∏á',type:'select',opts:['‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î','‡∏Ñ‡∏•‡∏±‡∏á A','‡∏Ñ‡∏•‡∏±‡∏á B']}
  ], cols:['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà','‡∏Ñ‡∏•‡∏±‡∏á','‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠(‡∏Å‡∏Å.)']},
  
  'quality-report': {title:'‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û', fields:[
    {k:'From',label:'‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà',type:'date'}, 
    {k:'To',label:'‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà',type:'date'}, 
    {k:'Metric',label:'‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î',type:'select',opts:['‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô','‡∏™‡∏¥‡πà‡∏á‡πÄ‡∏à‡∏∑‡∏≠‡∏õ‡∏ô','‡πÄ‡∏Å‡∏£‡∏î']}
  ], cols:['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà','‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î','‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢']},
  
  'trend-analysis': {title:'‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°', fields:[
    {k:'Period',label:'‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤',type:'select',opts:['‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô','‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå','‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô']}, 
    {k:'Metric',label:'‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î',type:'select',opts:['‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï','‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û','‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô']}, 
    {k:'Compare',label:'‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö',type:'select',opts:['‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô','‡∏õ‡∏µ‡∏Å‡πà‡∏≠‡∏ô','‡∏®‡∏π‡∏ô‡∏¢‡πå']}
  ], cols:['‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤','‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î','‡∏ú‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå']}
};

/* ====== AUTH ====== */
const KEY='cl_user';
function isAuthed(){return !!localStorage.getItem(KEY)}
function doLogin(e){
  e.preventDefault();
  const u=document.getElementById('u').value.trim();
  const p=document.getElementById('p').value;
  if(!u||p.length<4){alert('‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');return false}
  const role = (u.toLowerCase()==='admin')?'‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö':'‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô';
  localStorage.setItem(KEY, JSON.stringify({name:u,role}));
  route('#/dashboard');
  return false;
}
function fillDemo(){document.getElementById('u').value='admin';document.getElementById('p').value='1234'}
function logout(){
  localStorage.removeItem(KEY);
  route('#/login');
}

/* ====== ROUTER ====== */
let currentCode = null;
window.addEventListener('hashchange', ()=>route(location.hash));
function route(hash){
  const h = hash || (isAuthed() ? '#/dashboard' : '#/login');
  const [ , path, arg ] = h.split('/');
  showView(path, arg);
}
function showView(view,arg){
  document.getElementById('app-header').style.display = (view==='login')?'none':'flex';
  hideAll(['view-login','view-dashboard','view-page']);
  if(view==='login'){document.getElementById('view-login').style.display='flex';return}
  if(!isAuthed()){location.hash='#/login';return}
  const u=JSON.parse(localStorage.getItem(KEY)||'{}');
  document.getElementById('who').textContent = `${u.name}`;

  if(view==='dashboard'){document.getElementById('view-dashboard').style.display='block';return}
  if(view==='page'){ currentCode = arg; renderPage(arg); document.getElementById('view-page').style.display='block'; return}
  document.getElementById('view-dashboard').style.display='block';
}
function hideAll(ids){ids.forEach(id=>document.getElementById(id).style.display='none')}
function go(code){ location.hash = `#/page/${code}`; }

/* ====== PAGE RENDER ====== */
function renderPage(code){
  const cfg = routes[code];
  const title = cfg? cfg.title : '‡πÄ‡∏°‡∏ô‡∏π';
  document.getElementById('page-title').textContent = title;
  document.getElementById('crumb').textContent = title;

  // build form
  const fa = document.getElementById('form-area');
  fa.innerHTML='';
  (cfg?.fields||[]).forEach(f=>{
    const box=document.createElement('div');
    let html = `<label>${f.label}</label>`;
    if(f.type==='textarea'){
      html += `<textarea id="f_${f.k}" placeholder="${f.label}"></textarea>`;
    } else if(f.type==='select'){
      html += `<select id="f_${f.k}"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</option>`;
      (f.opts||[]).forEach(o=>html+=`<option>${o}</option>`);
      html += `</select>`;
    } else {
      html += `<input id="f_${f.k}" type="${f.type||'text'}" placeholder="${f.label}">`;
    }
    box.innerHTML = html;
    fa.appendChild(box);
  });

  // build table header
  const th=document.getElementById('th'); th.innerHTML='';
  (cfg?.cols||[]).forEach(c=>{
    const el=document.createElement('th'); el.textContent=c; th.appendChild(el);
  });

  // sample rows (mock)
  const tb=document.getElementById('tb'); tb.innerHTML='';
  const samples = ['ORD-2025-089', 'ORD-2025-088', 'ORD-2025-087'];
  const dates = ['08/10/2025', '07/10/2025', '06/10/2025'];
  const types = ['Arabica', 'Robusta', 'Blend'];
  
  for(let i=0;i<3;i++){
    const tr=document.createElement('tr');
    (cfg?.cols||[]).forEach((c,idx)=>{
      const td=document.createElement('td');
      let content = `‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ${i+1}`;
      
      if(c.includes('‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞')||c.includes('‡∏ú‡∏•')||c.includes('QC')){
        const status = i%2 ? 'ok' : 'warn';
        const text = i%2 ? '‡∏ú‡πà‡∏≤‡∏ô' : '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö';
        content = `<span class="pill ${status}">${text}</span>`;
      } else if(c.includes('‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà')){
        content = dates[i];
      } else if(c.includes('‡∏ä‡∏ô‡∏¥‡∏î')){
        content = types[i];
      } else if(c.includes('(‡∏Å‡∏Å.)')||c.includes('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô')){
        content = (200 + i*50) + ' ';
      } else if(c.includes('‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà')||c.includes('‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á')||c.includes('‡πÄ‡∏•‡∏Ç')){
        content = samples[i];
      }
      
      td.innerHTML = content;
      tr.appendChild(td);
    });
    tb.appendChild(tr);
  }
}

/* ====== SAVE (‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏à‡∏£‡∏¥‡∏á) ====== */
const okOv = document.getElementById('okOv');
const errOv = document.getElementById('errOv');
const okBtn = document.getElementById('okBtn');
const errOk = document.getElementById('errOk');
const seeErr = document.getElementById('seeErr');
const errBox = document.getElementById('errBox');

okBtn.addEventListener('click', ()=> closeModal(okOv));
errOk.addEventListener('click', ()=> closeModal(errOv));
seeErr.addEventListener('click', ()=> errBox.style.display = (errBox.style.display==='none'?'block':'none'));
[okOv,errOv].forEach(ov=>ov.addEventListener('click',e=>{ if(e.target===ov) closeModal(ov); }));
document.addEventListener('keydown', e => { if(e.key==='Escape'){ closeModal(okOv); closeModal(errOv); } });

function openModal(el){ el.classList.add('show'); el.setAttribute('aria-hidden','false'); }
function closeModal(el){ el.classList.remove('show'); el.setAttribute('aria-hidden','true'); }

async function savePage(){
  const cfg = routes[currentCode];
  if(!cfg){ alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ô‡∏µ‡πâ'); return; }

  // ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°
  const data = {};
  (cfg.fields||[]).forEach(f=>{
    const el = document.getElementById('f_'+f.k);
    data[f.k] = el ? el.value : '';
  });

  // ‡∏ï‡∏£‡∏ß‡∏à‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢ (‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å required ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ï‡πà‡∏≠ field)
  // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏° order-record ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ OrderNo, Customer
  // ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ä‡πà‡∏≠‡∏á
  const hasAny = Object.values(data).some(v=>String(v).trim()!=='');
  if(!hasAny){ alert('‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ä‡πà‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å'); return; }

  // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API
  try{
    const res = await fetch(`${API_BASE}/api/records`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({
        type: currentCode,              // ‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏ô‡∏¥‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏° ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á/‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡∏Å‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ù‡∏±‡πà‡∏á‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå
        title: cfg.title,               // ‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (‡∏≠‡∏≠‡∏õ‡∏ä‡∏±‡∏ô)
        data                              // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ü‡∏≠‡∏£‡πå‡∏°
      })
    });
    if(!res.ok){
      const t = await res.text().catch(()=> '');
      throw new Error(`HTTP ${res.status} ${res.statusText}\n${t}`);
    }
    // Success
    openModal(okOv);
  }catch(err){
    errBox.textContent = String(err);
    openModal(errOv);
  }
}

/* ====== DASHBOARD STATS DEMO ====== */
setInterval(()=>{
  const el=document.getElementById('kgToday');
  const v=parseInt(el.textContent.replace(/,/g,'')) + Math.floor(Math.random()*7);
  el.textContent=v.toLocaleString();
}, 4000);

/* ====== CHAT DRAWER ====== */
const chatEl=document.getElementById('chat');
const chatOverlay=document.getElementById('overlay');
const chatBody=document.getElementById('chatBody');
const chatInput=document.getElementById('chatInput');

const chatMessages = [
  {name:'‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ', time:'2 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß', msg:'‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ORD-2025-089 ‡∏Ñ‡∏£‡∏±‡∏ö'},
  {name:'Admin', time:'1 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß', msg:'‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡πà‡∏á‡∏Ñ‡∏£‡∏±‡∏ö', mine:true},
  {name:'‡∏Ñ‡∏∏‡∏ì‡∏ß‡∏¥‡πÑ‡∏• ‡∏£‡∏±‡∏Å‡∏™‡∏∏‡∏Ç', time:'15 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß', msg:'‡∏Ç‡∏≠‡πÉ‡∏ö‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏µ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ORD-2025-077 ‡∏Ñ‡∏£‡∏±‡∏ö'},
  {name:'‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡∏Å‡∏≤‡πÅ‡∏ü‡∏î‡∏µ ‡∏à‡∏≥‡∏Å‡∏±‡∏î', time:'1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß', msg:'‡∏™‡∏ô‡πÉ‡∏à‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏°‡∏•‡πá‡∏î‡∏Å‡∏≤‡πÅ‡∏ü Arabica ‡πÄ‡∏Å‡∏£‡∏î A ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô 500 ‡∏Å‡∏Å.'},
  {name:'‚ö†Ô∏è ‡∏£‡∏∞‡∏ö‡∏ö', time:'3 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß', msg:'‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (ORD-2025-076)'},
];

function toggleChat(open){
  chatEl.classList.toggle('open',!!open);
  chatOverlay.classList.toggle('open',!!open);
  chatEl.setAttribute('aria-hidden', open?'false':'true');
  if(open){
    renderChat();
    chatInput.focus();
  }
}

function renderChat(){
  chatBody.innerHTML='';
  chatMessages.forEach(m=>{
    const d=document.createElement('div');
    d.className = m.mine ? 'msg mine' : 'msg';
    d.innerHTML = `<strong>${m.name}</strong><br>${m.msg}<br><small style="opacity:0.7">${m.time}</small>`;
    chatBody.appendChild(d);
  });
  chatBody.scrollTop=chatBody.scrollHeight;
}

function sendChat(){
  const t=chatInput.value.trim();
  if(!t) return;
  chatMessages.push({name:'Admin', time:'‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ', msg:t, mine:true});
  chatInput.value='';
  renderChat();
  setTimeout(()=>{
    const replies = ['‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏±‡∏ö!', '‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡∏Ç‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà', '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏±‡∏ö'];
    const r = replies[Math.floor(Math.random()*replies.length)];
    chatMessages.push({name:'‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤', time:'‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ', msg:r});
    renderChat();
  }, 800);
}

// Mock incoming message
setInterval(()=>{
  if(!chatEl.classList.contains('open')){
    const msgs = ['‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏Ñ‡πà‡∏∞', '‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏™‡∏ï‡πá‡∏≠‡∏Å Arabica ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏£‡∏±‡∏ö', '‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á COD ‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö'];
    const m = msgs[Math.floor(Math.random()*msgs.length)];
    chatMessages.push({name:'‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤', time:'‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ', msg:m});
    inc('bdg-chat');
  }
}, 15000);

function inc(id){
  const el=document.getElementById(id);
  el.textContent = String(parseInt(el.textContent||'0',10)+1);
}

/* ====== INIT ====== */
route(location.hash);

/* ====== EXPOSE GLOBALS ====== */
window.go=go; window.savePage=savePage; window.logout=logout; window.toggleChat=toggleChat; window.fillDemo=fillDemo; window.doLogin=doLogin;
</script>
</body>
</html>
